<div [@routerTransition]>
    <div class="content d-flex flex-column flex-column-fluid">

        <sub-header [title]="'Power BI Reports' | localize" [description]="'Power-BI-ReportsHeaderInfo' | localize">
 
            <div role="actions">

                <button type="button"  *ngIf="'Pages.PowerBIReports.Create' | permission" class="btn btn-primary float-end" (click)="createPowerBIReport()"><i class="fa fa-plus btn-md-icon"></i>
                    <span class="d-none d-md-inline-block">{{ 'CreateNewPowerBIReport' | localize }}</span>
                </button>
    
            </div>

        </sub-header>

        <div [class]="containerClass">
            <div class="card card-custom gutter-b">
                <div class="card-body">

                    <div class="row align-items-center">

                        <!--<Primeng-TurboTable-Start> -->
                            <div class="primeng-datatable-container col-12" [busyIf]="primengTableHelper.isLoading">

                                <p-table
                                    #dataTable
                                    (onLazyLoad)="getPowerBIReports($event)"
                                    [value]="primengTableHelper.records"
                                    rows="{{ primengTableHelper.defaultRecordsCountPerPage }}"
                                    [paginator]="false"
                                    [lazy]="true"
                                    [scrollable]="true"
                                    [rowHover]="true"
                                    ScrollWidth="100%" 
                                    scrollDirection="horizontal"
                                    [responsive]="primengTableHelper.isResponsive"
                                    [resizableColumns]="primengTableHelper.resizableColumns">

                                    <!--
                                    <ng-template pTemplate="colgroup">
                                        <colgroup>
                                          <col style="width: 5%;">
                                          <col style="width: 30%;">
                                          <col style="width: 30%;">
                                          <col style="width: 35%;">
                                        </colgroup>
                                    </ng-template>
                                    -->

                                    <ng-template pTemplate="header">
                                        <tr>
                                            <th style="min-width: 80px" [hidden]="!isGrantedAny('Pages.PowerBIReports.Edit', 'Pages.PowerBIReports.Delete')">{{ l('Actions') }}</th>
                                            <th style="min-width: 400px" pSortableColumn="groupId">{{ l('GroupId') }} <p-sortIcon field="powerBIReport.groupId"></p-sortIcon></th>
                                            <th style="min-width: 400px" pSortableColumn="reportId">{{ l('ReportId') }} <p-sortIcon field="powerBIReport.reportId"></p-sortIcon></th>
                                            <!--<th style="width: 150px" pSortableColumn="url">{{ l('Url') }} <p-sortIcon field="powerBIReport.url"></p-sortIcon></th>-->
                                            <th style="min-width: 600px" pSortableColumn="description">{{ l('Description') }} <p-sortIcon field="powerBIReport.description"></p-sortIcon></th>
                                        </tr>
                                    </ng-template>

                                    <ng-template pTemplate="body" let-record="$implicit" let-i="rowIndex">
                                        <tr>
                                            <td style="min-width: 80px" [hidden]="!isGrantedAny('Pages.PowerBIReports.Edit', 'Pages.PowerBIReports.Delete')">

                                                <div class="btn-group dropdown" dropdown container="body">
                                                    <button class="dropdown-toggle btn btn-sm btn-primary" dropdownToggle><i class="fa fa-cog"></i><span class="caret"></span><!--{{ l('Actions') }}--></button>
                                                    <ul class="dropdown-menu" *dropdownMenu>

                                                        <!-- Chamar aqui o PowerBI -->
                                                        <li>
                                                            <a 
                                                                href="javascript:;" 
                                                                *ngIf="permission.isGranted('Pages.PowerBIReports.Edit')" 
                                                                class="dropdown-item" [routerLink]="['/app/main/power-bi-reports/powerbireportview']"
                                                                [queryParams]="{ id: record.powerBIReport.groupId }">
                                                                {{ l('PowerBIReportView') }}
                                                            </a>
                                                        </li>
                                                        <!-- Chamar aqui o PowerBI -->

                                                        <!--<li><a href="javascript:;" class="dropdown-item" (click)="viewAddressModal.show(record)">{{ l('View') }}</a></li>-->
                                                        <li>
                                                            <a 
                                                                href="javascript:;" 
                                                                *ngIf="permission.isGranted('Pages.PowerBIReports.Edit')" 
                                                                class="dropdown-item" (click)="createOrEditPowerBIReportModal.show(record.powerBIReport.id)">
                                                                {{ l('Edit') }}
                                                            </a>
                                                        </li>

                                                        <li>
                                                            <a 
                                                                href="javascript:;"
                                                                *ngIf="permission.isGranted('Pages.PowerBIReports.Delete')"
                                                                class="dropdown-item" (click)="deletePowerBIReport(record.powerBIReport)">
                                                                {{ l('Delete') }}
                                                            </a>
                                                        </li>

                                                    </ul>
                                                </div>
                                            </td>

                                            <td style="min-width: 400px" ><span class="p-column-title">{{ l('GroupId') }}</span>{{ record.powerBIReport.groupId }}</td>
                                            <td style="min-width: 400px" ><span class="p-column-title">{{ l('ReportId') }}</span>{{ record.powerBIReport.reportId }}</td>
                                            <!--<td style="width: 150px"><span class="p-column-title">{{ l('Url') }}</span>{{ record.powerBIReport.url }}</td>-->
                                            <td style="min-width: 600px"><span class="p-column-title">{{ l('Description') }}</span>{{ record.powerBIReport.description }}</td>
                                            
                                        </tr>
                                    </ng-template>

                                </p-table>
                                
                                <div class="primeng-no-data" *ngIf="primengTableHelper.totalRecordsCount == 0">
                                    {{ l('NoData') }}
                                </div>

                                <div class="primeng-paging-container">
                                    <p-paginator
                                        [rows]="primengTableHelper.defaultRecordsCountPerPage"
                                        #paginator
                                        (onPageChange)="getPowerBIReports($event)"
                                        [totalRecords]="primengTableHelper.totalRecordsCount"
                                        [rowsPerPageOptions]="primengTableHelper.predefinedRecordsCountPerPage"
                                        [showCurrentPageReport]="true"
                                        [currentPageReportTemplate]="'TotalRecordsCount' | localize: primengTableHelper.totalRecordsCount">
                                    </p-paginator>
                                </div>

                            </div>
                        <!--<Primeng-TurboTable-End>-->

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<createOrEditPowerBIReportModal #createOrEditPowerBIReportModal (modalSave)="getPowerBIReports()"></createOrEditPowerBIReportModal>