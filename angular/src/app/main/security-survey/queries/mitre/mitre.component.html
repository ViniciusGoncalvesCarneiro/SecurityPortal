<div [@routerTransition]>
    <div class="content d-flex flex-column flex-column-fluid">

        <sub-header [title]="'MITRE' | localize" [description]="'MitreHeaderInfo' | localize">

            <div role="actions">
            </div>

        </sub-header>

        <div [class]="containerClass">
            <div class="card card-custom gutter-b">
                <div class="card-body">

                    <div class="row align-items-center">

                        <!--<Primeng-TurboTable-Start>-->
                        <div class="primeng-datatable-container" [busyIf]="primengTableHelper.isLoading">

                        <p-table 
                        #dataTable 
                        sortMode="multiple" 
                        (onLazyLoad)="getMitre($event)"
                        [value]="primengTableHelper.records"
                        rows="{{ primengTableHelper.defaultRecordsCountPerPage }}" 
                        [paginator]="false"
                        [lazy]="true" 
                        [scrollable]="true" 
                        [rowHover]="true"
                        ScrollWidth="100%" 
                        scrollDirection="horizontal"
                        [responsive]="primengTableHelper.isResponsive"
                        [resizableColumns]="primengTableHelper.resizableColumns">

                        <ng-template pTemplate="header">
                        <tr>
                        <!--<th style="min-width: 130px" [hidden]="!(['Pages.Administration.Users.Impersonation', 'Pages.Administration.Users.Edit', 'Pages.Administration.Users.ChangePermissions', 'Pages.Administration.Users.Delete'] | permissionAny)">{{ 'Actions' | localize }}</th>-->
                        <th style="min-width: 100px" pSortableColumn="mitreId">{{ 'MitreId' | localize }} <p-sortIcon field="mitreId"></p-sortIcon></th>
                        <th style="min-width: 250px" pSortableColumn="stixId">{{ 'StixId' | localize }} <p-sortIcon field="stixId"></p-sortIcon></th>
                        <th style="min-width: 250px" pSortableColumn="name">{{ 'Name' | localize }}<p-sortIcon field="name"></p-sortIcon></th>
                        <th style="min-width: 300px" pSortableColumn="description">{{ 'Description' | localize }} <p-sortIcon field="description"></p-sortIcon></th>
                        <th style="min-width: 300px" pSortableColumn="url">{{ 'Url' | localize }} <p-sortIcon field="url"></p-sortIcon></th>

                        <th style="min-width: 200px" pSortableColumn="createdOn">{{ 'CreatedOn' | localize }} <p-sortIcon field="createdOn"></p-sortIcon></th>
                        <th style="min-width: 200px" pSortableColumn="lastModified">{{ 'LastModified' | localize }} <p-sortIcon field="lastModified"></p-sortIcon></th>

                        <th style="min-width: 100px" pSortableColumn="domain">{{ 'Domain' | localize }}<p-sortIcon field="domain"></p-sortIcon></th>
                        <th style="min-width: 100px" pSortableColumn="version">{{ 'Version' | localize }} <p-sortIcon field="version"></p-sortIcon></th>
                        <th style="min-width: 400px" pSortableColumn="relationshipCitation">{{ 'RelationshipCitation' | localize }} <p-sortIcon field="relationshipCitation"></p-sortIcon></th>
                        </tr>
                        </ng-template>

                        <ng-template pTemplate="body" let-record="$implicit">
                        <tr>
                        <!--
                        <td style="min-width: 130px" [hidden]="!(['Pages.Administration.Users.Impersonation', 'Pages.Administration.Users.Edit', 'Pages.Administration.Users.ChangePermissions', 'Pages.Administration.Users.Delete'] | permissionAny)">
                        <div class="btn-group" dropdown placement="bottom left" container="body">
                        <button id="dropdownButton" type="button" class="btn btn-primary btn-sm dropdown-toggle" dropdownToggle aria-controls="dropdownMenu"><i class="fa fa-cog"></i><span class="caret"></span>{{ 'Actions' | localize }}</button>
                        <ul id="dropdownMenu" class="dropdown-menu" role="menu" *dropdownMenu aria-labelledby="dropdownButton">
                        <li *ngIf="('Pages.Administration.Users.Impersonation' | permission) && record.id !== appSession.userId" role="menuitem"><a href="javascript:;" class="dropdown-item" (click)=" _impersonationService.impersonateUser(record.id, appSession.tenantId)">{{ 'LoginAsThisUser' | localize }}</a></li>
                        <li *ngIf="'Pages.Administration.Users.Edit' | permission" role="menuitem"><a href="javascript:;" class="dropdown-item" (click)="createOrEditUserModal.show(record.id)">{{ 'Edit' | localize }}</a></li>
                        <li *ngIf="'Pages.Administration.Users.ChangePermissions' | permission" role="menuitem"><a href="javascript:;" class="dropdown-item" (click)="editUserPermissionsModal.show(record.id,record.userName)">{{ 'Permissions' | localize }}</a></li>
                        <li *ngIf="'Pages.Administration.Users.Unlock' | permission" role="menuitem"><a href="javascript:;" class="dropdown-item" (click)="unlockUser(record)">{{ 'Unlock' | localize }}</a></li>
                        <li *ngIf="dynamicEntityPropertyManager.canShow('GumAdvisor.Authorization.Users.User')" role="menuitem"><a href="javascript:;" class="dropdown-item" (click)="showDynamicProperties(record)">{{ 'DynamicProperties' | localize }}</a></li>
                        <li *ngIf="'Pages.Administration.Users.Delete' | permission" role="menuitem"><a href="javascript:;" class="dropdown-item" (click)="deleteUser(record)">{{ 'Delete' | localize }}</a></li>
                        </ul>
                        </div>
                        </td>
                        -->

                        <td style="min-width: 100px"><span class="p-column-title">{{ 'MitreId' | localize }}</span>{{ record.mitre.mitreId }}</td>
                        <td style="min-width: 250px"><span class="p-column-title">{{ 'StixId' | localize }}</span>{{ record.mitre.stixId }}</td>
                        <td style="min-width: 250px"><span class="p-column-title">{{ 'Name' | localize }}</span>{{ record.mitre.name }}</td>
                        <td style="min-width: 300px"><span class="p-column-title">{{ 'Description' | localize }}</span><div style="height: 80px; overflow: auto;">{{ record.mitre.description  }}</div></td>
                        <td style="min-width: 300px"><span class="p-column-title">{{ 'Url' | localize }}</span>{{ record.mitre.url  }}</td>

                        <!--
                        <td style="min-width: 200px"><span class="p-column-title">{{ 'CreatedOn' | localize }}</span>{{ record.mitre.createdOn  }}</td>
                        <td style="min-width: 200px"><span class="p-column-title">{{ 'LastModified' | localize }}</span>{{ record.mitre.lastModified  }}</td>
                        -->

                        <td style="min-width: 200px">
                            <span class="p-column-title">{{ 'CreatedOn' | localize }}</span>
                            {{ record.mitre.createdOn | luxonFormat: 'F' }}
                        </td>
                        <td style="min-width: 200px">
                            <span class="p-column-title">{{ 'LastModified' | localize }}</span>
                            {{ record.mitre.lastModified | luxonFormat: 'F' }}
                        </td>



                        <td style="min-width: 100px"><span class="p-column-title">{{ 'Domain' | localize }}</span>{{ record.mitre.domain  }}</td>
                        <td style="min-width: 100px"><span class="p-column-title">{{ 'Version' | localize }}</span>{{ record.mitre.version  }}</td>
                        <td style="min-width: 400px"><span class="p-column-title">{{ 'RelationshipCitation' | localize }}</span>
                        <div style="height: 80px; overflow: auto;">
                        {{ record.mitre.relationshipCitation  }}
                        </div>
                        </td>

                        </tr>
                        </ng-template>
                        </p-table>

                        <div class="primeng-no-data" *ngIf="primengTableHelper.totalRecordsCount == 0">{{ 'NoData' | localize }}</div>

                        <div class="primeng-paging-container">
                        <p-paginator
                        [rows]="primengTableHelper.defaultRecordsCountPerPage"
                        #paginator
                        (onPageChange)="getMitre($event)"
                        [totalRecords]="primengTableHelper.totalRecordsCount"
                        [rowsPerPageOptions]="primengTableHelper.predefinedRecordsCountPerPage"
                        [showCurrentPageReport]="true" [currentPageReportTemplate]="'TotalRecordsCount' | localize: primengTableHelper.totalRecordsCount">
                        </p-paginator>
                        </div>
                        </div>
                        <!--<Primeng-TurboTable-End>-->

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

